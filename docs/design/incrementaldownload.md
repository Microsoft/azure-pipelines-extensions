# Incremental Download

## Overview
The feature is to allow Incremental Download of the Artifact in release so that all of the artifact items are not downloaded from the source provider 
and can be retrieved from a pre-maintained cache as well.

## Task Changes
A new task will be created named Generate Artifact Metadata that will generate artifact-metadata.csv file containing the filepaths and hashes
of artifact items mapped to one another, created in the same directory as that of the artifacts.

## Artifact Engine Changes
A CacheProvider will be initialized with a “Hash” that reads the old artifact-metadata.csv with the condition that the cache location contains a .verify file(that checks the correctness of the cache).

A new cache directory will be generated by the artifact engine under the folder _work\ArtifactEngineCache\SHA256HashofArtifact\ where the hash has the following format:
  - Build Artifacts : CollectionID.ProjectID.buildDefinitionID
  - Jenkins Artifacts : JenkinsURL.JobID
  - TeamCity Artifacts : teamCityURL.BuildConfigurationID

The new  artifact-metadata.csv will be read by artifact engine and the hashes will be stored in the artifactItemStore along with the artifactItems.

When worker call getItems to retrieve an item, cacheProvider will be called to check whether that item is present in cache or not. If yes, then item will be fetched from the cache otherwise from the sourceProvider itself.

Finally, when all the files are put to the desired destination cache will be updated by copying over the files downloaded, to the cache.

An additional .verify file will also be generated to check the correctness of the cache.

Validation of the downloaded files will be done while  copying them to the cache with the option to skip the validation step.

## Algorithm
```
  If(deploymentInput.enableIncrementalDownload is false)
	{
		//download all the artifacts
		Return releasedefinition.Artifacts;
	}
	Else
	{
		//download the artifacts incrementally
    Initialize cache by reading the hash of artifact type.
		If(artifactItem is in cache)
		{
			//download from the cache
			Return cache.artifactItem;
		}
		Else
		{
			//download from the sourceProvider
			Return sourceProvider.artifactItem;
		}
	}
```

## UI Changes
New task : Generate Artifact Metadata is created.

In Download Build Artifact Task: under advanced options, there will be an option to enable Incremental Download.
